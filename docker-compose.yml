version: "3.8"
services:
  nginx:
    build: ./nginx
    container_name: nginx
    env_file:
      - .env
    environment:
      - DOMAIN=${DOMAIN}
      - USE_TLS=${USE_TLS}
      - SSL_CERT_NAME=${SSL_CERT_NAME}
      - SSL_KEY_NAME=${SSL_KEY_NAME}
      - SLIVER_HTTP_PORT=${SLIVER_HTTP_PORT}
      - SLIVER_C2_PATH=${SLIVER_C2_PATH}
    ports:
      - "${NGINX_HTTP_PORT:-80}:80"
      - "${NGINX_HTTPS_PORT:-443}:443"
    volumes:
      - ${CERTS_HOST_DIR:-./certs}:/etc/nginx/certs
    restart: unless-stopped
    networks:
      - ${NETWORK_NAME:-demo_net}

  weather:
    build: ./weather
    container_name: weather
    environment:
      - BUILDS_DIR=/app/builds
      - ELECTRON_APP_URL_WIN=${ELECTRON_APP_URL_WIN:-}
      - ELECTRON_APP_URL_MAC=${ELECTRON_APP_URL_MAC:-}
      - ELECTRON_APP_URL_LINUX=${ELECTRON_APP_URL_LINUX:-}
      - ELECTRON_APP_URL_LINUX_RPM=${ELECTRON_APP_URL_LINUX_RPM:-}
      - BASE_URL=${BASE_URL:-}
    expose:
      - "5000"
    volumes:
      - ${BUILDS_DIR:-./builds}:/app/builds
    restart: unless-stopped
    networks:
      - ${NETWORK_NAME:-demo_net}

  sliver:
    build: ./sliver
    container_name: sliver
    stdin_open: true
    tty: true
    environment:
      - SLIVER_HTTP_PORT=${SLIVER_HTTP_PORT:-8080}
      - SLIVER_AUTOSTART_HTTP=${SLIVER_AUTOSTART_HTTP:-1}
    volumes:
      - ${SLIVER_CONFIG_DIR:-${HOME}/.sliver}:/home/sliver/.sliver
      - ${BUILDS_DIR:-./builds}:/home/sliver/builds
    networks:
      - ${NETWORK_NAME:-demo_net}

networks:
  demo_net:
    name: ${NETWORK_NAME:-demo_net}
    driver: bridge
